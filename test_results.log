============================= test session starts ==============================
platform darwin -- Python 3.12.9, pytest-8.4.0, pluggy-1.6.0 -- /Users/emanuelesabetta/Code/ENCHANT_BOOK_MANAGER/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /Users/emanuelesabetta/Code/ENCHANT_BOOK_MANAGER
configfile: pytest.ini
testpaths: tests
plugins: anyio-4.9.0, timeout-2.4.0, cov-6.2.1, mock-3.14.1
timeout: 300.0s
timeout method: thread
timeout func_only: False
collecting ... collected 268 items / 186 deselected / 82 selected

tests/test_e2e_chinese_to_epub.py::TestE2EChineseToEPUB::test_single_novel_complete_pipeline 2025-06-17 04:03:16,421 - INFO - Successfully fetched model pricing information from https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json
2025-06-17 04:03:16,423 - DEBUG - UniversalDetector: utf-8 (confidence: 0.99)
2025-06-17 04:03:16,423 - DEBUG - Detected encoding: utf-8 (confidence: 0.99)
2025-06-17 04:03:16,423 - DEBUG - Successfully decoded with utf-8
2025-06-17 04:03:16,423 - INFO - File '/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpug2fn1wx/修炼至尊.txt' used 280 tokens. Cost: $0.000078
2025-06-17 04:03:16,423 - INFO - Renaming '/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpug2fn1wx/修炼至尊.txt' to '/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpug2fn1wx/Cultivation Supreme by Unknown Author (Weizhi Zuozhe) - 修炼至尊 by 未知作者.txt'
Novel processing completed successfully!
Files in translation directory: ['translated_Cultivation Supreme by Unknown Author.txt']
Warning: No EPUB file found. This is expected due to directory name mismatch issue.
PASSED
tests/test_e2e_chinese_to_epub.py::TestE2EChineseToEPUB::test_batch_processing_multiple_novels 2025-06-17 04:03:16,504 - INFO - Successfully fetched model pricing information from https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json
2025-06-17 04:03:16,506 - DEBUG - UniversalDetector: utf-8 (confidence: 0.99)
2025-06-17 04:03:16,506 - DEBUG - Detected encoding: utf-8 (confidence: 0.99)
2025-06-17 04:03:16,506 - DEBUG - Successfully decoded with utf-8
2025-06-17 04:03:16,506 - INFO - File '/private/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpop3j748v/修炼至尊.txt' used 280 tokens. Cost: $0.000078
2025-06-17 04:03:16,506 - INFO - Renaming '/private/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpop3j748v/修炼至尊.txt' to '/private/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpop3j748v/Cultivation Supreme by Unknown Author (Weizhi Zuozhe) - 修炼至尊 by 未知作者.txt'
Book imported successfully. Book ID: 9e3e4545-ffbe-4b21-b217-f25e69854bb0
Translated book saved successfully.
2025-06-17 04:03:16,555 - INFO - Successfully fetched model pricing information from https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json
2025-06-17 04:03:16,557 - DEBUG - UniversalDetector: utf-8 (confidence: 0.99)
2025-06-17 04:03:16,557 - DEBUG - Detected encoding: utf-8 (confidence: 0.99)
2025-06-17 04:03:16,557 - DEBUG - Successfully decoded with utf-8
2025-06-17 04:03:16,557 - INFO - File '/private/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpop3j748v/都市异能王.txt' used 255 tokens. Cost: $0.000072
2025-06-17 04:03:16,557 - INFO - Renaming '/private/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpop3j748v/都市异能王.txt' to '/private/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpop3j748v/Urban Ability King by Unknown Author (Weizhi Zuozhe) - 都市异能王 by 未知作者.txt'
Book imported successfully. Book ID: 495db8e4-2d5f-49cc-8998-4d2af3b1648c
Translated book saved successfully.
2025-06-17 04:03:16,608 - INFO - Successfully fetched model pricing information from https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json
2025-06-17 04:03:16,610 - DEBUG - UniversalDetector: utf-8 (confidence: 0.99)
2025-06-17 04:03:16,610 - DEBUG - Detected encoding: utf-8 (confidence: 0.99)
2025-06-17 04:03:16,610 - DEBUG - Successfully decoded with utf-8
2025-06-17 04:03:16,610 - INFO - File '/private/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpop3j748v/魔法学院.txt' used 268 tokens. Cost: $0.000075
2025-06-17 04:03:16,610 - INFO - Renaming '/private/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpop3j748v/魔法学院.txt' to '/private/var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpop3j748v/Magic Academy by Unknown Author (Weizhi Zuozhe) - 魔法学院 by 未知作者.txt'
Book imported successfully. Book ID: 16ab68b2-9009-454e-931c-7bb1549173b7
Translated book saved successfully.
Files in translation directory: ['translated_Cultivation Supreme by Unknown Author (Weizhi Zuozhe).txt', 'Cultivation Supreme by Unknown Author (Weizhi Zuozhe) - Chunk_000001.txt']
Warning: No EPUB file found. This is expected due to directory name mismatch issue.
Files in translation directory: ['Urban Ability King by Unknown Author (Weizhi Zuozhe) - Chunk_000001.txt', 'translated_Urban Ability King by Unknown Author (Weizhi Zuozhe).txt']
Warning: No EPUB file found. This is expected due to directory name mismatch issue.
Files in translation directory: ['Magic Academy by Unknown Author (Weizhi Zuozhe) - Chunk_000001.txt', 'translated_Magic Academy by Unknown Author (Weizhi Zuozhe).txt']
Warning: No EPUB file found. This is expected due to directory name mismatch issue.
PASSED
tests/test_e2e_chinese_to_epub.py::TestE2EChineseToEPUB::test_resume_functionality 2025-06-17 04:03:16,672 - INFO - Successfully fetched model pricing information from https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json
2025-06-17 04:03:16,674 - DEBUG - UniversalDetector: utf-8 (confidence: 0.99)
2025-06-17 04:03:16,674 - DEBUG - Detected encoding: utf-8 (confidence: 0.99)
2025-06-17 04:03:16,674 - DEBUG - Successfully decoded with utf-8
2025-06-17 04:03:16,944 - ERROR - Error making OpenAI request: 401 Client Error: Unauthorized for url: https://api.openai.com/v1/chat/completions
2025-06-17 04:03:16,944 - ERROR - Error processing novel file /var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpzszhx4kj/修炼至尊.txt: 401 Client Error: Unauthorized for url: https://api.openai.com/v1/chat/completions
Novel processing completed with some issues. Check logs for details.
FAILED

=================================== FAILURES ===================================
________________ TestE2EChineseToEPUB.test_resume_functionality ________________
tests/test_e2e_chinese_to_epub.py:610: in test_resume_functionality
    assert len(renamed_files) == 1
E   assert 0 == 1
E    +  where 0 = len([])
------------------------------ Captured log call -------------------------------
INFO     renamenovels:renamenovels.py:255 Successfully fetched model pricing information from https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json
DEBUG    renamenovels:common_file_utils.py:75 UniversalDetector: utf-8 (confidence: 0.99)
DEBUG    renamenovels:common_file_utils.py:169 Detected encoding: utf-8 (confidence: 0.99)
DEBUG    renamenovels:common_file_utils.py:176 Successfully decoded with utf-8
ERROR    renamenovels:renamenovels.py:286 Error making OpenAI request: 401 Client Error: Unauthorized for url: https://api.openai.com/v1/chat/completions
ERROR    renamenovels:renamenovels.py:520 Error processing novel file /var/folders/j5/4vmcr_496wsbmt3dl3k8f11r0000gn/T/tmpzszhx4kj/修炼至尊.txt: 401 Client Error: Unauthorized for url: https://api.openai.com/v1/chat/completions
WARNING  enchant_cli:enchant_cli.py:172 Renaming failed for 修炼至尊.txt, continuing with original name
=========================== short test summary info ============================
FAILED tests/test_e2e_chinese_to_epub.py::TestE2EChineseToEPUB::test_resume_functionality - assert 0 == 1
 +  where 0 = len([])
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
================= 1 failed, 2 passed, 186 deselected in 0.83s ==================
